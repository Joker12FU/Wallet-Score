<script>
  const scanBtn = document.getElementById("scanBtn");
  const addressEl = document.getElementById("address");
  const chainEl = document.getElementById("chain");
  const status = document.getElementById("status");
  const raw = document.getElementById("raw");

  scanBtn.onclick = async () => {
    const address = addressEl.value.trim();
    const chain = chainEl.value;
    if (!address) { alert("Enter an address"); return; }

    status.style.display = "block";
    status.innerHTML = '<span class="spinner"></span> Scanning…';
    raw.innerHTML = "";

    try {
      const r = await fetch("/api/scan", {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify({ address, chain })
      });

      const j = await r.json();

      if (!r.ok) {
        status.innerHTML = "Error: " + (j.error || JSON.stringify(j));
        return;
      }

      status.innerHTML = `<strong>Score: ${j.score}/100</strong> · <span class="label">${j.labels.join(", ")}</span>`;
      raw.innerHTML = "<pre>" + JSON.stringify(j.details, null, 2) + "</pre>";

    } catch (e) {
      status.innerHTML = "Network error: " + e.message;
    }
  };
</script>
